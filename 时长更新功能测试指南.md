# 时长更新功能测试指南

## 功能描述
当用户在设置中修改倒计时时长时，如果当前正在计时，计时器会立即重置为新的时长并重新开始计时。

## 测试场景

### 测试1：工作模式时长更新
1. **启动工作模式计时器**
   - 打开应用，进入工作模式
   - 启动计时器（例如：25分钟）
   - 确认计时器正常运行

2. **修改工作时长**
   - 点击设置按钮
   - 在"Work duration"滑块中调整时长（例如：从25分钟改为15分钟）
   - 观察计时器是否立即重置

3. **验证结果**
   - 计时器应该立即停止当前计时
   - 剩余时间应该更新为新的时长（15分钟）
   - 计时器应该重新开始倒计时
   - Boss血条进度应该重置

### 测试2：休息模式时长更新
1. **启动休息模式计时器**
   - 完成一个工作周期，进入休息模式
   - 启动休息计时器（例如：6分钟）
   - 确认计时器正常运行

2. **修改休息时长**
   - 点击设置按钮
   - 在"Relax duration"滑块中调整时长（例如：从6分钟改为10分钟）
   - 观察计时器是否立即重置

3. **验证结果**
   - 计时器应该立即停止当前计时
   - 剩余时间应该更新为新的时长（10分钟）
   - 计时器应该重新开始倒计时

### 测试3：非计时状态下的时长更新
1. **准备测试环境**
   - 确保当前没有计时器在运行
   - 进入设置界面

2. **修改时长设置**
   - 调整工作或休息时长
   - 关闭设置界面

3. **验证结果**
   - 不应该有任何计时器启动
   - 下次启动计时器时应该使用新的时长设置

### 测试4：后台状态下的时长更新
1. **启动计时器并切换到后台**
   - 启动工作或休息模式计时器
   - 切换到其他应用

2. **修改时长设置**
   - 在后台状态下，通过设置修改时长
   - 切回应用

3. **验证结果**
   - 应用应该检测到时长更新
   - 计时器应该重置为新的时长

## 控制台日志验证

### 工作时长更新日志
```
SettingsView: 工作时长更新为 X 分钟
MainView: 收到工作时长更新通知
MainView: 处理工作时长更新 - 新时长: X分钟
MainView: 重置工作模式计时器
MainView: 工作模式计时器已重置 - 新剩余时间: XXX秒
```

### 休息时长更新日志
```
SettingsView: 休息时长更新为 X 分钟
MainView: 收到休息时长更新通知
MainView: 处理休息时长更新 - 新时长: X分钟
MainView: 重置休息模式计时器
MainView: 休息模式计时器已重置 - 新剩余时间: XXX秒
```

## 边界情况测试

### 测试5：极短时长更新
1. **设置极短时长**
   - 将工作时长设置为1分钟
   - 将休息时长设置为5分钟
   - 验证计时器正常工作

### 测试6：极长时长更新
1. **设置极长时长**
   - 将工作时长设置为60分钟
   - 将休息时长设置为30分钟
   - 验证计时器正常工作

### 测试7：快速连续更新
1. **快速调整滑块**
   - 快速连续调整时长滑块
   - 验证计时器能够正确处理多次更新
   - 确保不会出现状态不一致

## 预期行为

### ✅ 正确行为
- 时长更新时，正在运行的计时器立即重置
- 剩余时间正确更新为新时长
- 计时器重新开始倒计时
- 工作模式下Boss血条进度重置
- 控制台显示正确的日志信息

### ❌ 错误行为
- 计时器没有重置，继续使用旧时长
- 剩余时间计算错误
- 计时器状态不一致
- 没有日志输出
- 应用崩溃或卡死

## 故障排除

### 问题1：计时器没有重置
**可能原因：**
- 通知没有正确发送
- 通知观察者没有正确注册
- 条件判断逻辑错误

**解决方法：**
- 检查控制台日志
- 确认通知观察者已注册
- 验证条件判断逻辑

### 问题2：剩余时间计算错误
**可能原因：**
- 时长单位转换错误
- 状态同步问题

**解决方法：**
- 检查时长计算逻辑
- 验证状态同步机制

### 问题3：应用崩溃
**可能原因：**
- 通知观察者重复注册
- 内存访问错误

**解决方法：**
- 检查通知观察者的注册和移除
- 验证内存管理

## 测试报告模板

```
测试日期：____年____月____日
测试设备：iPhone ____ (iOS ____)
测试版本：Focus Buddy v1.1.0

测试结果：
□ 工作模式时长更新 - 通过/失败
□ 休息模式时长更新 - 通过/失败
□ 非计时状态时长更新 - 通过/失败
□ 后台状态时长更新 - 通过/失败
□ 极短时长更新 - 通过/失败
□ 极长时长更新 - 通过/失败
□ 快速连续更新 - 通过/失败

问题记录：
1. ________________
2. ________________
3. ________________

建议改进：
1. ________________
2. ________________
3. ________________
```

## 注意事项

1. **用户体验**：时长更新应该是即时的，用户不需要等待
2. **状态一致性**：确保UI状态和后台状态保持一致
3. **性能考虑**：快速连续更新不应该影响应用性能
4. **错误处理**：异常情况下应该有适当的错误处理
